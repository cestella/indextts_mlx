{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://example.local/index-tts/segment.schema.json",
  "title": "IndexTTS Segment Record (JSONL line)",
  "type": "object",
  "additionalProperties": false,
  "required": ["text"],
  "properties": {
    "segment_id": {
      "description": "Unique identifier for the segment within a chapter/book (string or integer).",
      "oneOf": [
        { "type": "string", "minLength": 1 },
        { "type": "integer", "minimum": 0 }
      ]
    },
    "chapter_id": {
      "description": "Optional chapter identifier.",
      "oneOf": [
        { "type": "string", "minLength": 1 },
        { "type": "integer", "minimum": 0 }
      ]
    },
    "text": {
      "description": "The text to synthesize for this segment.",
      "type": "string",
      "minLength": 1
    },
    "segment_type": {
      "description": "Optional label used for pacing or downstream logic.",
      "type": "string",
      "enum": ["narration", "dialogue", "heading", "scene_break", "footnote", "other"]
    },

    "emotion": {
      "description": "High-level emotion preset label. Renderer maps this to the per-voice calibrated (emo_vector, emo_alpha) defaults.",
      "type": "string",
      "enum": ["neutral", "mild_emphasis", "indignant", "joyful", "suspense", "melancholic", "calm_authority"]
    },

    "emo_alpha": {
      "description": "Emotion influence strength (0..1). Overrides preset alpha if provided.",
      "type": "number",
      "minimum": 0.0,
      "maximum": 1.0
    },
    "emo_vector": {
      "description": "Optional low-level override vector of 8 floats: [happy, angry, sad, afraid, disgusted, melancholic, surprised, calm]. Overrides preset vector if provided.",
      "type": "array",
      "minItems": 8,
      "maxItems": 8,
      "items": { "type": "number" }
    },
    "emo_text": {
      "description": "Optional low-level override emotion description used when use_emo_text=true (or auto-enabled if present).",
      "type": "string",
      "minLength": 1
    },
    "use_emo_text": {
      "description": "If present, explicitly enables/disables using emo_text. If omitted and emo_text is present, renderer should auto-enable.",
      "type": "boolean"
    },
    "emo_audio_prompt": {
      "description": "Optional path to emotion reference audio (low-level override).",
      "type": "string",
      "minLength": 1
    },
    "metadata": {
      "description": "Free-form metadata for upstream/downstream tooling (not used by TTS).",
      "type": "object",
      "additionalProperties": true
    }
  },

  "allOf": [
    {
      "description": "Disallow mixing emo_vector and emo_text: pick one low-level override style (or neither).",
      "not": {
        "allOf": [
          { "required": ["emo_vector"] },
          { "required": ["emo_text"] }
        ]
      }
    },
    {
      "description": "If emotion preset is omitted, renderer should default to neutral.",
      "if": { "not": { "required": ["emotion"] } },
      "then": {}
    }
  ]
}
